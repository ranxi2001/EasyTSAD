# CoarseGrained-MTSç®—æ³•åˆ†ææŠ¥å‘Š
## åŸºäºç²—ç²’åº¦å˜é‡å†…å¤–ä¾èµ–å…³ç³»çš„å¤šå…ƒæ—¶åºå¼‚å¸¸æ£€æµ‹

---

## ğŸ“‹ è®ºæ–‡æ¦‚è¿°

**æ ‡é¢˜**: Multivariate Time Series Anomaly Detection by Capturing Coarse-Grained Intra- and Inter-Variate Dependencies

**æ ¸å¿ƒåˆ›æ–°**: é€šè¿‡æ•è·ç²—ç²’åº¦çš„å˜é‡å†…å’Œå˜é‡é—´ä¾èµ–å…³ç³»è¿›è¡Œå¤šå…ƒæ—¶åºå¼‚å¸¸æ£€æµ‹

**æŠ€æœ¯å…³é”®è¯**: 
- Coarse-Grained Feature Extraction (ç²—ç²’åº¦ç‰¹å¾æŠ½å–)
- Intra-Variate Dependencies (å˜é‡å†…ä¾èµ–) 
- Inter-Variate Dependencies (å˜é‡é—´ä¾èµ–)
- Multivariate Time Series Anomaly Detection

---

## ğŸ” æŠ€æœ¯æ¶æ„æ¨æµ‹

åŸºäºè®ºæ–‡æ ‡é¢˜å’Œå½“å‰SOTAæŠ€æœ¯è¶‹åŠ¿ï¼Œè¯¥ç®—æ³•å¯èƒ½åŒ…å«ä»¥ä¸‹æ ¸å¿ƒæ¨¡å—ï¼š

### 1. ç²—ç²’åº¦ç‰¹å¾æå–å™¨ (Coarse-Grained Feature Extractor)
```python
# ç›®æ ‡ï¼šé™ä½æ—¶åºæ•°æ®çš„ç»†ç²’åº¦å™ªå£°ï¼Œæå–å…³é”®æ¨¡å¼
- å¤šå°ºåº¦å·ç§¯æ± åŒ–
- è‡ªé€‚åº”ä¸‹é‡‡æ ·  
- æ—¶åºå—èšåˆ
- ç‰¹å¾å‹ç¼©ä¸é‡æ„
```

### 2. å˜é‡å†…ä¾èµ–å»ºæ¨¡ (Intra-Variate Dependency Modeling)
```python
# ç›®æ ‡ï¼šæ•è·å•ä¸ªå˜é‡çš„æ—¶åºè‡ªç›¸å…³æ€§
- æ—¶åºè‡ªæ³¨æ„åŠ›æœºåˆ¶
- LSTM/GRUå¾ªç¯å»ºæ¨¡
- æ—¶åºå·ç§¯ç½‘ç»œ(TCN)
- å˜é‡å†…çš„é•¿çŸ­æœŸä¾èµ–å…³ç³»
```

### 3. å˜é‡é—´ä¾èµ–å»ºæ¨¡ (Inter-Variate Dependency Modeling)  
```python
# ç›®æ ‡ï¼šå»ºæ¨¡å¤šå˜é‡ä¹‹é—´çš„ç›¸äº’å½±å“å…³ç³»
- å›¾ç¥ç»ç½‘ç»œ(GNN)
- è·¨å˜é‡æ³¨æ„åŠ›æœºåˆ¶
- å˜é‡å…³ç³»çŸ©é˜µå­¦ä¹ 
- åŠ¨æ€ä¾èµ–å›¾æ„å»º
```

### 4. å¼‚å¸¸æ£€æµ‹æ¨¡å— (Anomaly Detection Module)
```python
# ç›®æ ‡ï¼šåŸºäºä¾èµ–å…³ç³»åå·®æ£€æµ‹å¼‚å¸¸
- é‡æ„è¯¯å·®è®¡ç®—
- ä¾èµ–å…³ç³»ä¸€è‡´æ€§æ£€éªŒ
- å¤šå±‚æ¬¡å¼‚å¸¸åˆ†æ•°èåˆ
- è‡ªé€‚åº”é˜ˆå€¼è®¾å®š
```

---

## ğŸš€ é¢„æœŸæŠ€æœ¯ä¼˜åŠ¿

### 1. ç²—ç²’åº¦å»ºæ¨¡ä¼˜åŠ¿
- **å™ªå£°é²æ£’æ€§**: å‡å°‘ç»†ç²’åº¦å™ªå£°å¹²æ‰°
- **è®¡ç®—æ•ˆç‡**: é™ä½æ•°æ®ç»´åº¦ï¼Œæå‡å¤„ç†é€Ÿåº¦
- **æ¨¡å¼æ•è·**: èšç„¦å…³é”®æ—¶åºæ¨¡å¼å’Œè¶‹åŠ¿
- **æ³›åŒ–èƒ½åŠ›**: æå‡è·¨åŸŸå’Œè·¨åœºæ™¯é€‚åº”æ€§

### 2. åŒé‡ä¾èµ–å»ºæ¨¡
- **å…¨é¢æ€§**: åŒæ—¶è€ƒè™‘å˜é‡å†…å¤–ä¾èµ–å…³ç³»
- **äº’è¡¥æ€§**: ä¸¤ç±»ä¾èµ–ä¿¡æ¯ç›¸äº’è¡¥å……éªŒè¯
- **ç²¾ç¡®æ€§**: æ›´ç²¾å‡†çš„å¼‚å¸¸æ¨¡å¼è¯†åˆ«
- **å¯è§£é‡Šæ€§**: æ˜ç¡®å¼‚å¸¸çš„ä¾èµ–å…³ç³»æ¥æº

### 3. å¤šå…ƒæ—¶åºä¸“ç”¨è®¾è®¡
- **ç»´åº¦é€‚é…**: ä¸“é—¨é’ˆå¯¹é«˜ç»´æ—¶åºæ•°æ®ä¼˜åŒ–
- **ä¾èµ–å»ºæ¨¡**: å……åˆ†åˆ©ç”¨å¤šå˜é‡ååŒä¿¡æ¯
- **æ—¶ç©ºèåˆ**: æ—¶é—´å’Œç©ºé—´(å˜é‡)ç»´åº¦è”åˆå»ºæ¨¡
- **ç«¯åˆ°ç«¯**: ä»ç‰¹å¾æå–åˆ°å¼‚å¸¸æ£€æµ‹çš„ç»Ÿä¸€æ¡†æ¶

---

## ğŸ“Š é¢„æœŸæ€§èƒ½è¡¨ç°

åŸºäºæŠ€æœ¯æ¶æ„åˆ†æï¼Œé¢„æœŸè¯¥ç®—æ³•åœ¨ä»¥ä¸‹æ–¹é¢è¡¨ç°ä¼˜å¼‚ï¼š

### Point-wiseå¼‚å¸¸æ£€æµ‹
- **ç›®æ ‡æ€§èƒ½**: Point F1 â‰¥ 94%
- **ä¼˜åŠ¿æ¥æº**: ç²—ç²’åº¦ç‰¹å¾å‡å°‘å™ªå£°å¹²æ‰°
- **é€‚ç”¨åœºæ™¯**: ç²¾ç¡®çš„æ—¶é—´ç‚¹å¼‚å¸¸å®šä½

### Event-basedå¼‚å¸¸æ£€æµ‹  
- **ç›®æ ‡æ€§èƒ½**: Event F1 â‰¥ 78%
- **ä¼˜åŠ¿æ¥æº**: ä¾èµ–å…³ç³»å»ºæ¨¡æ•è·å¼‚å¸¸äº‹ä»¶
- **é€‚ç”¨åœºæ™¯**: è¿ç»­å¼‚å¸¸äº‹ä»¶è¯†åˆ«

### è®¡ç®—æ•ˆç‡
- **å‚æ•°å¤æ‚åº¦**: ä¸­ç­‰ (50K-100Kå‚æ•°)
- **æ¨ç†é€Ÿåº¦**: å¿«é€Ÿ (ç²—ç²’åº¦å¤„ç†é™ä½è®¡ç®—é‡)
- **å†…å­˜å ç”¨**: ä¼˜åŒ– (ç‰¹å¾å‹ç¼©å‡å°‘å­˜å‚¨éœ€æ±‚)

---

## ğŸ—ï¸ ç®—æ³•æ¶æ„è®¾è®¡

### æ•´ä½“æµç¨‹
```
åŸå§‹MTSæ•°æ® â†’ ç²—ç²’åº¦ç‰¹å¾æå– â†’ åŒé‡ä¾èµ–å»ºæ¨¡ â†’ å¼‚å¸¸åˆ†æ•°è®¡ç®— â†’ å¼‚å¸¸æ£€æµ‹ç»“æœ
     â†“              â†“                â†“              â†“             â†“
  [B,L,D]      [B,L',D']      [å†…ä¾èµ–,å¤–ä¾èµ–]     [å¼‚å¸¸åˆ†æ•°]      [0/1æ ‡ç­¾]
```

### æ ¸å¿ƒæ¨¡å—è¯¦è§£

#### 1. ç²—ç²’åº¦ç‰¹å¾æå–å™¨
```python
class CoarseGrainedExtractor(nn.Module):
    def __init__(self, input_dim, seq_len, coarse_factor=4):
        # å¤šå°ºåº¦ä¸‹é‡‡æ ·
        self.temporal_pooling = AdaptiveAvgPool1d(seq_len // coarse_factor)
        # ç‰¹å¾å‹ç¼©
        self.feature_compress = nn.Linear(input_dim, input_dim // 2)
        # é‡è¦æ€§åŠ æƒ
        self.attention_weights = nn.Parameter(torch.ones(input_dim))
    
    def forward(self, x):
        # æ—¶åºç²—åŒ–
        x_coarse = self.temporal_pooling(x.transpose(1,2)).transpose(1,2)
        # ç‰¹å¾å‹ç¼©
        x_compressed = self.feature_compress(x_coarse)
        # æ³¨æ„åŠ›åŠ æƒ
        x_weighted = x_compressed * self.attention_weights
        return x_weighted
```

#### 2. å˜é‡å†…ä¾èµ–å»ºæ¨¡
```python
class IntraVariateDependency(nn.Module):
    def __init__(self, feature_dim, seq_len):
        # æ—¶åºè‡ªæ³¨æ„åŠ›
        self.temporal_attention = MultiHeadSelfAttention(feature_dim)
        # æ—¶åºå·ç§¯
        self.temporal_conv = TemporalConvNet(feature_dim)
        
    def forward(self, x):
        # æ¯ä¸ªå˜é‡ç‹¬ç«‹å»ºæ¨¡æ—¶åºä¾èµ–
        intra_deps = []
        for i in range(x.shape[-1]):
            var_i = x[:, :, i:i+1]  # [B, L, 1]
            # è‡ªæ³¨æ„åŠ›æ•è·é•¿æœŸä¾èµ–
            att_out = self.temporal_attention(var_i)
            # å·ç§¯æ•è·å±€éƒ¨ä¾èµ–  
            conv_out = self.temporal_conv(var_i)
            # èåˆ
            intra_dep = att_out + conv_out
            intra_deps.append(intra_dep)
        return torch.cat(intra_deps, dim=-1)
```

#### 3. å˜é‡é—´ä¾èµ–å»ºæ¨¡
```python
class InterVariateDependency(nn.Module):
    def __init__(self, feature_dim, num_vars):
        # å˜é‡å…³ç³»å›¾å­¦ä¹ 
        self.relation_learner = nn.Parameter(torch.randn(num_vars, num_vars))
        # å›¾å·ç§¯ç½‘ç»œ
        self.gcn = GraphConvNet(feature_dim)
        # è·¨å˜é‡æ³¨æ„åŠ›
        self.cross_attention = CrossVariateAttention(feature_dim)
        
    def forward(self, x):
        B, L, D = x.shape
        # å­¦ä¹ å˜é‡å…³ç³»çŸ©é˜µ
        relation_matrix = torch.softmax(self.relation_learner, dim=-1)
        
        # åŸºäºå…³ç³»å›¾çš„ä¿¡æ¯ä¼ æ’­
        x_graph = self.gcn(x, relation_matrix)
        
        # è·¨å˜é‡æ³¨æ„åŠ›
        x_cross = self.cross_attention(x)
        
        # èåˆä¸¤ç§å»ºæ¨¡æ–¹å¼
        inter_dep = x_graph + x_cross
        return inter_dep, relation_matrix
```

#### 4. å¼‚å¸¸æ£€æµ‹å¤´
```python
class AnomalyDetectionHead(nn.Module):
    def __init__(self, feature_dim):
        # é‡æ„è·¯å¾„
        self.reconstruction = nn.Linear(feature_dim, feature_dim)
        # å¼‚å¸¸åˆ†æ•°é¢„æµ‹
        self.anomaly_scorer = nn.Sequential(
            nn.Linear(feature_dim * 2, 64),  # å†…å¤–ä¾èµ–æ‹¼æ¥
            nn.ReLU(),
            nn.Linear(64, 1),
            nn.Sigmoid()
        )
        
    def forward(self, intra_dep, inter_dep):
        # é‡æ„åŸå§‹è¾“å…¥
        reconstructed = self.reconstruction(inter_dep)
        
        # å¼‚å¸¸åˆ†æ•°è®¡ç®—
        combined_features = torch.cat([intra_dep, inter_dep], dim=-1)
        anomaly_scores = self.anomaly_scorer(combined_features)
        
        return reconstructed, anomaly_scores
```

---

## ğŸ¯ æ ¸å¿ƒåˆ›æ–°ç‚¹åˆ†æ

### 1. ç²—ç²’åº¦å»ºæ¨¡åˆ›æ–°
- **æ—¶åºç²—åŒ–**: è‡ªé€‚åº”æ—¶åºä¸‹é‡‡æ ·ï¼Œä¿ç•™å…³é”®æ¨¡å¼
- **ç‰¹å¾å‹ç¼©**: ç»´åº¦çº¦ç®€ä½†ä¿æŒä¿¡æ¯å®Œæ•´æ€§
- **å™ªå£°æŠ‘åˆ¶**: ç²—ç²’åº¦å¤„ç†å¤©ç„¶å…·å¤‡é™å™ªæ•ˆæœ
- **æ•ˆç‡æå‡**: å‡å°‘è®¡ç®—å¤æ‚åº¦ï¼Œæå‡å¤„ç†é€Ÿåº¦

### 2. åŒé‡ä¾èµ–å»ºæ¨¡åˆ›æ–°
- **å¹¶è¡Œå»ºæ¨¡**: å˜é‡å†…å¤–ä¾èµ–åŒæ—¶å»ºæ¨¡ï¼Œä¿¡æ¯äº’è¡¥
- **å±‚æ¬¡å»ºæ¨¡**: ä»å•å˜é‡åˆ°å¤šå˜é‡çš„å±‚æ¬¡åŒ–ä¾èµ–æŠ½å–
- **åŠ¨æ€é€‚åº”**: ä¾èµ–å…³ç³»å¯å­¦ä¹ ï¼Œé€‚åº”ä¸åŒæ•°æ®ç‰¹æ€§
- **è”åˆä¼˜åŒ–**: å†…å¤–ä¾èµ–åœ¨ç»Ÿä¸€æ¡†æ¶ä¸‹ååŒä¼˜åŒ–

### 3. å¼‚å¸¸æ£€æµ‹åˆ›æ–°
- **å¤šç»´å¼‚å¸¸**: åŸºäºé‡æ„å’Œä¾èµ–ä¸€è‡´æ€§çš„åŒé‡å¼‚å¸¸æ£€æµ‹
- **è‡ªé€‚åº”é˜ˆå€¼**: æ ¹æ®ä¾èµ–å¼ºåº¦åŠ¨æ€è°ƒæ•´æ£€æµ‹é˜ˆå€¼
- **å¯è§£é‡Šæ€§**: æ˜ç¡®æŒ‡å‡ºå¼‚å¸¸æ¥æºäºå“ªç±»ä¾èµ–å…³ç³»
- **é²æ£’æ€§**: ç²—ç²’åº¦å»ºæ¨¡æå‡å¯¹å™ªå£°çš„é²æ£’æ€§

---

## ğŸ“ˆ ä¸ç°æœ‰ç®—æ³•å¯¹æ¯”

### vs MTSMixerLighter
| ç»´åº¦ | MTSMixerLighter | CoarseGrained-MTS | ä¼˜åŠ¿æ–¹ |
|------|-----------------|-------------------|--------|
| **ç‰¹å¾å»ºæ¨¡** | å•ä¸€å°ºåº¦ | ç²—ç²’åº¦å¤šå±‚æ¬¡ | **CoarseGrained** |
| **ä¾èµ–å»ºæ¨¡** | ç®€å•æ—¶åºæ··åˆ | åŒé‡ä¾èµ–ç³»ç»Ÿ | **CoarseGrained** |
| **è®¡ç®—æ•ˆç‡** | æç®€è®¾è®¡ | ç²—ç²’åº¦ä¼˜åŒ– | MTSMixerLighter |
| **å¼‚å¸¸æ£€æµ‹** | é‡æ„è¯¯å·® | å¤šç»´åº¦å¼‚å¸¸æ£€æµ‹ | **CoarseGrained** |

### vs AMAD  
| ç»´åº¦ | AMAD | CoarseGrained-MTS | ä¼˜åŠ¿æ–¹ |
|------|------|-------------------|--------|
| **æ¶æ„å¤æ‚åº¦** | é«˜å¤æ‚åº¦ | ä¸­ç­‰å¤æ‚åº¦ | **CoarseGrained** |
| **ç‰¹å¾æŠ½å–** | å¤šå°ºåº¦ç²¾ç»† | ç²—ç²’åº¦èšç„¦ | å„æœ‰ç‰¹è‰² |
| **ä¾èµ–å»ºæ¨¡** | æ³¨æ„åŠ›æœºåˆ¶ | ä¸“ç”¨åŒé‡å»ºæ¨¡ | **CoarseGrained** |
| **ç¨³å®šæ€§** | å¾…æ”¹è¿› | é¢„æœŸç¨³å®š | **CoarseGrained** |

---

## ğŸš€ å®ç°ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§æ¨¡å— (æ ¸å¿ƒåˆ›æ–°)
1. **ç²—ç²’åº¦ç‰¹å¾æå–å™¨** - ç®—æ³•æ ¸å¿ƒåˆ›æ–°
2. **åŒé‡ä¾èµ–å»ºæ¨¡ç³»ç»Ÿ** - æŠ€æœ¯äº®ç‚¹
3. **å¤šç»´å¼‚å¸¸æ£€æµ‹å¤´** - æ€§èƒ½å…³é”®

### ä¸­ä¼˜å…ˆçº§æ¨¡å— (æ€§èƒ½ä¼˜åŒ–)
1. **è‡ªé€‚åº”ä¸‹é‡‡æ ·ç­–ç•¥** - æ•ˆç‡ä¼˜åŒ–
2. **åŠ¨æ€ä¾èµ–å›¾å­¦ä¹ ** - é€‚åº”æ€§æå‡
3. **å¯è§£é‡Šæ€§åˆ†ææ¨¡å—** - åº”ç”¨ä»·å€¼

### ä½ä¼˜å…ˆçº§æ¨¡å— (å·¥ç¨‹åŒ–)
1. **è¶…å‚æ•°è‡ªåŠ¨è°ƒä¼˜** - æ˜“ç”¨æ€§
2. **æ¨¡å‹å‹ç¼©ä¸åŠ é€Ÿ** - éƒ¨ç½²ä¼˜åŒ–
3. **å¯è§†åŒ–åˆ†æå·¥å…·** - ç”¨æˆ·ä½“éªŒ

---

## ğŸ“Š é¢„æœŸå®éªŒç»“æœ

### æ€§èƒ½é¢„æœŸ
| æŒ‡æ ‡ | ä¿å®ˆä¼°è®¡ | ä¹è§‚ä¼°è®¡ | ç›®æ ‡ |
|------|----------|----------|------|
| **Point F1** | 93.5% | 96.0% | 94%+ |
| **Event F1 (log)** | 72.0% | 82.0% | 75%+ |
| **Event F1 (squeeze)** | 65.0% | 78.0% | 70%+ |
| **å‚æ•°é‡** | 80K | 120K | <100K |
| **æ¨ç†é€Ÿåº¦** | 15ms | 8ms | <20ms |

### ä¼˜åŠ¿åœºæ™¯
- **é«˜ç»´æ—¶åºæ•°æ®**: å˜é‡æ•° â‰¥ 20çš„å¤æ‚ç³»ç»Ÿ
- **å™ªå£°ç¯å¢ƒ**: å«æœ‰è¾ƒå¤šç»†ç²’åº¦å™ªå£°çš„æ•°æ®
- **é•¿åºåˆ—**: æ—¶åºé•¿åº¦ â‰¥ 1000çš„æ•°æ®
- **å¤æ‚ä¾èµ–**: å˜é‡é—´å­˜åœ¨å¤æ‚ç›¸äº’ä½œç”¨

---

## ğŸ“ å­¦æœ¯ä»·å€¼ä¸å·¥ç¨‹æ„ä¹‰

### å­¦æœ¯è´¡çŒ®
- **ç†è®ºåˆ›æ–°**: ç²—ç²’åº¦å»ºæ¨¡åœ¨æ—¶åºå¼‚å¸¸æ£€æµ‹ä¸­çš„åº”ç”¨
- **æ–¹æ³•åˆ›æ–°**: åŒé‡ä¾èµ–å»ºæ¨¡çš„ç»Ÿä¸€æ¡†æ¶
- **å®éªŒè´¡çŒ®**: å…¨é¢çš„åŸºå‡†æµ‹è¯•å’Œæ¶ˆèåˆ†æ
- **é¢†åŸŸæ¨è¿›**: ä¸ºå¤šå…ƒæ—¶åºå¼‚å¸¸æ£€æµ‹æä¾›æ–°æ€è·¯

### å·¥ç¨‹ä»·å€¼
- **å®ç”¨æ€§**: é€‚åˆå·¥ä¸šçº§é«˜ç»´æ—¶åºç›‘æ§
- **å¯æ‰©å±•æ€§**: ç²—ç²’åº¦å¤„ç†æ”¯æŒå¤§è§„æ¨¡æ•°æ®
- **å¯è§£é‡Šæ€§**: ä¾èµ–å»ºæ¨¡æä¾›å¼‚å¸¸è§£é‡Š
- **éƒ¨ç½²å‹å¥½**: è®¡ç®—æ•ˆç‡ä¼˜åŒ–æ”¯æŒå®æ—¶åº”ç”¨

---

## ğŸ”® æŠ€æœ¯å‘å±•è¶‹åŠ¿

### çŸ­æœŸå‘å±• (6ä¸ªæœˆ)
- ç²—ç²’åº¦å»ºæ¨¡æŠ€æœ¯çš„è¿›ä¸€æ­¥ä¼˜åŒ–
- ä¾èµ–å…³ç³»å­¦ä¹ ç®—æ³•çš„æ”¹è¿›
- æ›´é«˜æ•ˆçš„å›¾ç¥ç»ç½‘ç»œæ¶æ„

### ä¸­æœŸå‘å±• (1-2å¹´)  
- è‡ªé€‚åº”ç²—ç²’åº¦ç­–ç•¥çš„æ™ºèƒ½åŒ–
- è·¨åŸŸä¾èµ–å…³ç³»çš„è¿ç§»å­¦ä¹ 
- å¤šæ¨¡æ€æ—¶åºæ•°æ®çš„ç»Ÿä¸€å»ºæ¨¡

### é•¿æœŸæ„¿æ™¯ (3-5å¹´)
- è®¤çŸ¥å±‚é¢çš„ä¾èµ–å…³ç³»ç†è§£
- å› æœæ¨ç†åœ¨å¼‚å¸¸æ£€æµ‹ä¸­çš„åº”ç”¨
- äººæœºååŒçš„å¼‚å¸¸è¯Šæ–­ç³»ç»Ÿ

---

*æŠ€æœ¯åˆ†ææŠ¥å‘Š | 2025-05-30*  
*åŸºäºè®ºæ–‡æ ‡é¢˜å’ŒæŠ€æœ¯è¶‹åŠ¿çš„é¢„æµ‹æ€§åˆ†æ*  
*ä¸‹ä¸€æ­¥ï¼šå®ç°CoarseGrained-MTSç®—æ³•åŸå‹* 